<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My HTML Document</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://getbootstrap.com/docs/5.3/assets/css/docs.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

    <!--  COLORS! 
    D4CBE5 (Thistle)
    70566D (Chinese Violet)
    42273B (Dark Purple)
    9E9885 (Khaki)
    7C7F65 (Reseda Green)
     -->


    <!-- <link
      href="https://fonts.googleapis.com/css?family=Fira+Sans"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="/vendor/bootstrap/css/bootstrap.css"
    />
    <script src="/vendor/bootstrap/js/bootstrap.bundle.js"></script>
    <link rel="stylesheet" type="text/css" href="/css/main.css" /> -->

    <style>
        .card {
            margin: 0 auto;
        }

        .profile-name-input {
            margin-bottom: 16px;
        }

        .profile-card {
            max-width: 400px;
        }

        .profile-pic {
            width: 100px;
            height: 100px;
            border-radius: 6px;
            margin: 12px auto;
            display: block;
        }

        #myCarousel{
            width: 950px;
            margin: auto;
        }
        .card {
        margin: 0 auto;
        }

        .profile-name-input {
            margin-bottom: 16px;
        }

        .profile-card {
            max-width: 400px;
        }

        .profile-pic {
            width: 100px;
            height: 100px;
            border-radius: 6px;
            margin: 12px auto;
            display: block;
        }
    </style>
</head>

<body style="font-family: Helvetica Neue">
      <nav class="navbar bg-body-tertiary fixed-top">
        <div class="container-fluid">
            <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbar"
                aria-controls="offcanvasNavbar" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <a class="navbar-brand" href="../index.html">BookSmart</a>
            <form class="d-flex" role="search" action="../book-search/task1.html">
                <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search" id="book-input-1">
                <button class="btn btn-outline-success" type="submit" id="book-search-1">Search</button>
            </form>
            <!-- <img class="profile-pic" src="/images/profile.svg"/> -->

            <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasNavbar"
                aria-labelledby="offcanvasNavbarLabel">
                <div class="offcanvas-header">
                    <h5 class="offcanvas-title" id="offcanvasNavbarLabel"><a href="../index.html">BookSmart</a></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                </div>
                <div class="offcanvas-body">
                    <ul class="navbar-nav justify-content-end flex-grow-1 pe-3">
                        <li class="nav-item">
                            <a class="nav-link active" aria-current="page" href="../index.html">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="recommendations/task3.html">Recommendations</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="../discussions/task2.html">Discussions</a>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                                aria-expanded="false">
                                Dropdown
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#">Action</a></li>
                                <li><a class="dropdown-item" href="#">Another action</a></li>
                                <li>
                                    <hr class="dropdown-divider">
                                </li>
                                <li><a class="dropdown-item" href="#">Something else here</a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>

        <div class="btn-group">
            <button type="button" class="btn btn-secondary" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <img src="images/profile.svg" alt="Button Image">
            </button>
            <form class="dropdown-menu p-4">
                <div class="form-group">
                  <label for="usernameform">Username</label>
                  <input type="text" class="form-control" id="usernameform" placeholder="Username">
                </div>
                <div class="form-group">
                  <label for="passwordform">Password</label>
                  <input type="text" class="form-control" id="passwordform" placeholder="Password">
                </div>
                <button type="submit" id = "signinbutton" class="btn btn-primary">Sign in</button>
              </form>
        </div>


    </nav>
    
      
    
      <div
        class="modal fade"
        id="profilePicModal"
        tabindex="-1"
        aria-labelledby="profilePicModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h1 class="modal-title fs-5" id="profilePicModalLabel">
                Change profile pic
              </h1>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <label for="profile-pic-file" class="form-label">
                Choose a new profile pic
              </label>

              <!-- Add a file uploader component here! -->
              <input class="form-control" type="file" id="avatar" name="avatar" accept="image/png, image/jpeg" />
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                Close
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>




    <a href="recommendations/task3.html">Link to Recommendations</a>
    <a href="book-search/task1.html">Link to Search and Shelves</a>
    <a href="profile/pf_page.html">Link to Profile</a>

    <div id="myCarousel" class="carousel slide" data-ride="carousel">
        <!-- Indicators -->
        <ol class="carousel-indicators">
          <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
          <li data-target="#myCarousel" data-slide-to="1"></li>
          <li data-target="#myCarousel" data-slide-to="2"></li>
        </ol>
      
        <!-- Wrapper for slides -->
        <div class="carousel-inner">
          <div class="item active">
            <img src="images/the_familiar_ad.jpeg" alt="Los Angeles">
          </div>
      
          <div class="item">
            <img src="images/taty.jpg" alt="Chicago">
          </div>
      
          <!-- <div class="item">
            <img src="ny.jpg" alt="New York">
          </div> -->
        </div>
      
        <!-- Left and right controls -->
        <a class="left carousel-control" href="#myCarousel" data-slide="prev">
          <span class="glyphicon glyphicon-chevron-left"></span>
          <span class="sr-only">Previous</span>
        </a>
        <a class="right carousel-control" href="#myCarousel" data-slide="next">
          <span class="glyphicon glyphicon-chevron-right"></span>
          <span class="sr-only">Next</span>
        </a>
      </div>

      <script>
      $('.myCarousel').carousel({
        interval: 1000
      })

       let searchButton1 = document.getElementById("book-search-1");
       searchButton1.addEventListener(
        "click", () => {
            var input = document.getElementById("book-input-1").value;
            localStorage.setItem("search", input);
        }
       );

       const closeModal = () => {
        const modal = document.getElementById("profilePicModal");
        const modalInstance = bootstrap.Modal.getInstance(modal);
        modalInstance.hide();
      };

      // This function takes a data URL and resizes it down so it can be stored in localStorage.
      // Loading the image isn't instant, so the function returns a *Promise*.
      // You can use .then() to specify code that should run after the image is resized:
      // resizeAndCropPic(dataUrl).then((croppedDataUrl) => {
      //   // do something with croppedDataUrl
      // });
      // (or use async/await!)
      const resizeAndCropPic = (dataUrl) => {
        // crop to the center and resize to 512x512
        return new Promise((resolve) => {
          const canvas = document.createElement("canvas");
          [canvas.width, canvas.height] = [512, 512];
          const ctx = canvas.getContext("2d");

          const img = new Image();
          img.src = dataUrl;
          img.onload = () => {
            const [width, height] = [img.width, img.height];
            const [shorter, longer] =
              width < height ? [width, height] : [height, width];
            const [x, y] =
              width < height
                ? [0, (height - width) / 2]
                : [(width - height) / 2, 0];
            ctx.drawImage(img, x, y, shorter, shorter, 0, 0, 512, 512);
            const croppedDataUrl = canvas.toDataURL("image/jpeg");
            resolve(croppedDataUrl);
          };
        });
      };


      function saveName() {
        localStorage.setItem("currUser", username.value);
        // console.log(localStorage.getItem("currUser"));

      }


      window.onload = (event) => {
        if (localStorage.getItem("currUser")){
          document.getElementById("name-input").value = localStorage.getItem("currUser");
        }
        if (localStorage.getItem("profilePhoto")){
          document.getElementsByClassName("profile-pic")[0].src = localStorage.getItem("profilePhoto");
        }
      };
      

      var username = document.getElementById("name-input");
      //username.oninput = function() {saveName()};

      
      var profileUpload = document.getElementById("avatar");
      profileUpload.oninput = function() {uploadPhoto()};
      var profilePic = document.getElementsByClassName("profile-pic")[0];

      function uploadPhoto(){
        const file = document.getElementById("avatar").files[0];
        console.log(file);
        const reader = new FileReader();

        
        reader.addEventListener(
        "load",
        () => {
          // convert image file to base64 string
          resizeAndCropPic(reader.result).then((croppedDataUrl) => {
            localStorage.setItem("profilePhoto", croppedDataUrl);
            profilePic.src = croppedDataUrl;
          });
         
        },
        false,
      );

      if (file) {
        reader.readAsDataURL(file);
      }
      closeModal();
      }


      //PROFILE FUNCTIONALITY
      localStorage.setItem("login", "amateur");
      localStorage.setItem("password", "aces");

      const storedUsername = localStorage.getItem("login");
      const storedPassword = localStorage.getItem("password");

      const button = document.getElementById("signinbutton");
      button.addEventListener("click", () => {
        var profUsername = document.getElementById("usernameform").value;
        var profPassword = document.getElementById("passwordform").value;

        if (storedUsername == profUsername && storedPassword == profPassword) {
            window.location.replace("../profile/pf_page.html");    
        }

        //const notif = document.getElementById("notification");
        if (storedUsername == profUsername && storedPassword != profPassword) {
            alert("Sorry, your password is incorrect!");
        }

        if (storedUsername != profUsername) {
            alert("Sorry, we don't recognize your username!");
        }
          
      });

      </script>
      









</body>

</html>